<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Messenger</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- AUTH SCREEN -->
  <div id="auth-screen" class="screen active">
    <div class="auth-container">
      <div class="auth-logo">
        <svg viewBox="0 0 48 48" width="120" height="120">
          <circle cx="24" cy="24" r="24" fill="#2AABEE"/>
          <path d="M10.7 23.2l22.8-9.4c1-.4 1.9.3 1.6 1.4l-3.9 18.3c-.3 1.2-1 1.5-2 .9l-5.6-4.1-2.7 2.6c-.3.3-.6.6-1.2.6l.4-5.7 10.3-9.3c.4-.4-.1-.6-.7-.2L16.4 26l-5.4-1.7c-1.2-.4-1.2-1.2.3-1.7z" fill="white"/>
        </svg>
      </div>
      <h1 class="auth-title">Messenger</h1>
      <p class="auth-subtitle" id="auth-subtitle">Войдите, чтобы продолжить</p>

      <form id="auth-form" class="auth-form">
        <div class="form-group" id="displayname-group" style="display:none">
          <input type="text" id="displayname-input" class="form-input" placeholder="Ваше имя" autocomplete="name">
        </div>
        <div class="form-group">
          <input type="text" id="username-input" class="form-input" placeholder="Имя пользователя (логин)" autocomplete="username">
        </div>
        <div class="form-group">
          <input type="password" id="password-input" class="form-input" placeholder="Пароль" autocomplete="current-password">
        </div>
        <div id="auth-error" class="auth-error"></div>
        <button type="submit" id="auth-btn" class="auth-btn">Войти</button>
      </form>

      <p class="auth-switch">
        <span id="auth-switch-text">Нет аккаунта?</span>
        <a href="#" id="auth-switch-link">Зарегистрироваться</a>
      </p>
    </div>
  </div>

  <!-- MAIN APP -->
  <div id="app-screen" class="screen">
    <div class="app-layout">
      <!-- SIDEBAR -->
      <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
          <button class="icon-btn" id="menu-btn" title="Меню">
            <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
          </button>
          <div class="search-container">
            <svg class="search-icon" viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
            <input type="text" id="search-input" class="search-input" placeholder="Поиск">
          </div>
        </div>

        <!-- Side menu -->
        <div id="side-menu-overlay" class="side-menu-overlay" style="display:none"></div>
        <div id="side-menu" class="side-menu">
          <div class="side-menu-header">
            <div class="side-menu-avatar" id="menu-avatar"></div>
            <div class="side-menu-user-info">
              <div class="side-menu-name" id="menu-name"></div>
              <div class="side-menu-username" id="menu-username"></div>
            </div>
          </div>
          <div class="side-menu-items">
            <button class="side-menu-item" id="menu-profile">
              <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
              <span>Мой профиль</span>
            </button>
            <button class="side-menu-item" id="menu-contacts">
              <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
              <span>Контакты</span>
            </button>
            <button class="side-menu-item" id="menu-settings">
              <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 00.12-.61l-1.92-3.32a.488.488 0 00-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 00-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58a.49.49 0 00-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
              <span>Настройки</span>
            </button>
            <div class="side-menu-divider"></div>
            <button class="side-menu-item side-menu-item-danger" id="menu-logout">
              <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg>
              <span>Выйти</span>
            </button>
          </div>
        </div>

        <!-- Profile modal -->
        <div id="profile-modal" class="modal-overlay" style="display:none">
          <div class="modal">
            <div class="modal-header">
              <h3>Мой профиль</h3>
              <button class="icon-btn modal-close" id="profile-close">
                <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
              </button>
            </div>
            <div class="modal-body">
              <div class="profile-avatar-wrapper" id="profile-avatar-wrapper">
                <div class="profile-avatar" id="profile-avatar"></div>
                <div class="profile-avatar-overlay">
                  <svg viewBox="0 0 24 24" width="28" height="28"><path fill="white" d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/><path fill="white" d="M20 4h-3.17L15 2H9L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-8 13c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z" transform="scale(0.5) translate(22,22)" opacity="0.9"/></svg>
                  <span>Изменить фото</span>
                </div>
                <input type="file" id="avatar-input" accept="image/*" style="display:none">
              </div>
              <div class="profile-field">
                <label>Имя</label>
                <div class="profile-value" id="profile-display-name"></div>
              </div>
              <div class="profile-field">
                <label>Логин</label>
                <div class="profile-value" id="profile-username"></div>
              </div>
              <div class="profile-field">
                <label>ID</label>
                <div class="profile-value profile-id" id="profile-id"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Settings modal -->
        <div id="settings-modal" class="modal-overlay" style="display:none">
          <div class="modal">
            <div class="modal-header">
              <h3>Настройки</h3>
              <button class="icon-btn modal-close" id="settings-close">
                <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
              </button>
            </div>
            <div class="modal-body">
              <div class="settings-item">
                <span>Уведомления</span>
                <label class="toggle">
                  <input type="checkbox" id="setting-notifications" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div class="settings-item">
                <span>Звук сообщений</span>
                <label class="toggle">
                  <input type="checkbox" id="setting-sound" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div class="settings-info">
                <p>Messenger v1.0</p>
              </div>
            </div>
          </div>
        </div>

        <div id="chat-list" class="chat-list">
          <div class="empty-state" id="no-chats">
            <p>Нет чатов</p>
            <p class="empty-hint">Найдите пользователя через поиск</p>
          </div>
        </div>

        <!-- Search results overlay -->
        <div id="search-results" class="search-results" style="display:none">
          <div class="search-results-header">Пользователи</div>
          <div id="search-results-list"></div>
        </div>
      </div>

      <!-- CHAT AREA -->
      <div id="chat-area" class="chat-area">
        <!-- Empty state -->
        <div id="chat-empty" class="chat-empty">
          <div class="chat-empty-icon">
            <svg viewBox="0 0 48 48" width="120" height="120">
              <circle cx="24" cy="24" r="24" fill="var(--accent)" opacity="0.15"/>
              <path d="M10.7 23.2l22.8-9.4c1-.4 1.9.3 1.6 1.4l-3.9 18.3c-.3 1.2-1 1.5-2 .9l-5.6-4.1-2.7 2.6c-.3.3-.6.6-1.2.6l.4-5.7 10.3-9.3c.4-.4-.1-.6-.7-.2L16.4 26l-5.4-1.7c-1.2-.4-1.2-1.2.3-1.7z" fill="var(--accent)" opacity="0.4"/>
            </svg>
          </div>
          <p class="chat-empty-text">Выберите чат для начала общения</p>
        </div>

        <!-- Chat view -->
        <div id="chat-view" class="chat-view" style="display:none">
          <div class="chat-header">
            <button class="icon-btn back-btn" id="back-btn">
              <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            </button>
            <div class="chat-header-avatar" id="chat-avatar"></div>
            <div class="chat-header-info">
              <div class="chat-header-name" id="chat-name"></div>
              <div class="chat-header-status" id="chat-status"></div>
            </div>
            <div class="chat-header-actions">
              <button class="icon-btn" title="Поиск">
                <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
              </button>
              <button class="icon-btn" title="Ещё">
                <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>
              </button>
            </div>
          </div>

          <div class="messages-container" id="messages-container">
            <div class="messages-list" id="messages-list"></div>
          </div>

          <div class="typing-indicator" id="typing-indicator" style="display:none">
            <span class="typing-text" id="typing-text">печатает</span>
            <span class="typing-dots"><span>.</span><span>.</span><span>.</span></span>
          </div>

          <div class="message-input-area">
            <div class="emoji-wrapper">
              <button class="icon-btn emoji-btn" id="emoji-btn" title="Эмодзи">
                <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"/></svg>
              </button>
              <div class="emoji-picker" id="emoji-picker" style="display:none">
                <div class="emoji-tabs" id="emoji-tabs"></div>
                <div class="emoji-grid" id="emoji-grid"></div>
              </div>
            </div>
            <div class="input-wrapper">
              <textarea id="message-input" class="message-input" placeholder="Сообщение" rows="1"></textarea>
            </div>
            <button class="send-btn" id="send-btn" title="Отправить">
              <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
            </button>
            <button class="mic-btn" id="mic-btn" title="Голосовое сообщение">
              <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/></svg>
            </button>
          </div>

          <!-- Voice recording overlay -->
          <div class="voice-recording-overlay" id="voice-recording-overlay" style="display:none">
            <button class="voice-cancel-btn" id="voice-cancel-btn" title="Отмена">
              <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
            </button>
            <div class="voice-recording-indicator">
              <div class="voice-recording-dot"></div>
              <span class="voice-recording-timer" id="voice-recording-timer">0:00</span>
            </div>
            <button class="voice-send-btn" id="voice-send-btn" title="Отправить">
              <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="/js/app.js"></script>
</body>
</html>
